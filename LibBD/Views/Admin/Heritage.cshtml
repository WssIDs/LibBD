@model IEnumerable<LibDB.DAL.Author>

@{
    ViewBag.Title = "Администрирование баз";
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
}

<h3>Наследие</h3>
    
<table class="table table-sm table-bordered">
    <thead>
        <tr>
            <th style="width: 80px">#</th>
            <th>Заглавие</th>
            <th style="width: 100px">Год</th>
            <th>ФИО</th>
            <th>Название</th>
            <th style="width: 180px">Год выпуска</th>
            <th colspan="3" width="50px"></th>
        </tr>
    </thead>
    <thead>
        <tr class="filters">
            <th style="width: 80px"><input type="number" class="form-control"></th>
            <th><input type="text" class="form-control"></th>
            <th style="width: 100px"><input type="number" class="form-control"></th>
            <th><input type="text" class="form-control"></th>
            <th><input type="text" class="form-control"></th>
            <th style="width: 180px"><input type="number" class="form-control"></th>
            <th colspan="3" width="50px">@Html.ActionLink("Добавить...", "HeritageCreate", null, new { @class = "btn btn-outline-success" })</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
        <tr>
            <th scope="row">
                @Html.DisplayFor(model => item.AuthorId)
            </th>
            <td>
                @Html.DisplayFor(model => item.CardTitle)
            </td>
            <td align="center">
                @Html.DisplayFor(model => item.CardYear)
            </td>
            <td>
                @Html.DisplayFor(model => item.LastName) @Html.DisplayFor(model => item.FirstName)
            </td>
            <td>
                @Html.DisplayFor(model => item.Title)
            </td>
            <td align="center">
                @Html.DisplayFor(model => item.Year)
            </td>
            <td width="40px">
                <a href="@Url.Action("HeritageEdit", "Admin",new { id = item.AuthorId })" class="btn btn-sm btn-primary">
                    <i class="fa fa-edit"></i>
                </a>
            </td>
            <td width="40px">
                <a href="@Url.Action("HeritageDetails", "Admin",new { id = item.AuthorId })" class="btn btn-sm btn-info">
                    <i class="fa fa-eye"></i>
                </a>
            </td>
            <td width="40px">
                <a href="@Url.Action("HeritageDelete", "Admin",new { id = item.AuthorId })" class="btn btn-sm btn-danger">
                    <i class="fa fa-trash"></i>
                </a>
            </td>
        </tr>
        }
    </tbody>
</table>

@section Scripts
{
    <script>
        $(document).ready(function () {
            $('.filterable .btn-filter').click(function () {
                var $panel = $(this).parents('.filterable'),
                    $filters = $panel.find('.filters input'),
                    $tbody = $panel.find('.table tbody');
                if ($filters.prop('disabled') == true) {
                    $filters.prop('disabled', false);
                    $filters.first().focus();
                } else {
                    $filters.val('').prop('disabled', true);
                    $tbody.find('.no-result').remove();
                    $tbody.find('tr').show();
                }
            });

            $('.filterable .filters input').keyup(function (e) {
                /* Ignore tab key */
                var code = e.keyCode || e.which;
                if (code == '9') return;
                /* Useful DOM data and selectors */
                var $input = $(this),
                    inputContent = $input.val().toLowerCase(),
                    $panel = $input.parents('.filterable'),
                    column = $panel.find('.filters th').index($input.parents('th')),
                    $table = $panel.find('.table'),
                    $rows = $table.find('tbody tr');
                /* Dirtiest filter function ever ;) */
                var $filteredRows = $rows.filter(function () {
                    var value = $(this).find('td').eq(column).text().toLowerCase();
                    return value.indexOf(inputContent) === -1;
                });
                /* Clean previous no-result if exist */
                $table.find('tbody .no-result').remove();
                /* Show all rows, hide filtered ones (never do that outside of a demo ! xD) */
                $rows.show();
                $filteredRows.hide();
                /* Prepend no-result row if all rows are filtered */
                if ($filteredRows.length === $rows.length) {
                    $table.find('tbody').prepend($('<tr class="no-result text-center"><td colspan="' + $table.find('.filters th').length + '">Результаты не найдены</td></tr>'));
                }
            });
        });
    </script>
}
